---
title: 网络延迟和网络延时
date: 2020-10-13 19:25:09
tags:
  - network
---

在计算机网络开发中，我们经常会遇到两个概念，延迟（delay）和延时（latency）。中文含义的一字之差让我们经常困惑，他们究竟有什么区别？

## 是什么
延迟（delay）是指网络中的数据从一个端点传输到另一个端点所需的时间，通常以毫秒为单位。延迟受多个因素影响，包括数据包的大小，流量大小等。  
延时（latency）本质上与延迟紧密相关。有时延时被直接解释为延迟。而更常见的情况是，延时表示往返时间。往返时间包含了发送数据包所需的时间，以及它返回的时间。但并不包括目的地处理数据包所花费的时间。  

## 什么导致了延迟
延迟主要由四方面原因造成：处理延迟、排队延迟、传输延迟和传播延迟。

**1. 处理延迟**是指系统对数据包报头进行分析和确定数据包被发送到哪里去所要花费的时间。这很大程度上取决于路由表中的条目数量、系统中数据结构的执行以及硬件的实现。

**2. 排队延迟**是指数据包从进入发送队列到被发送之间经过的时间。这取决于流量大小、流量类型以及具体实现中采用什么路由器队列算法。不同的算法效果不一样，有的可以根据系统参数调整延迟时间，或者对所有流量设定相应的延迟时间。

**3. 传输延迟**是指将包中的数据位传入线路所需要的时间。根据数据包的大小和带宽的不同而有所变化。但并不取决于传输线路的距离，因为它仅仅是指将包的数据位传入线路的时间，而不是沿传输线路到达接收端点的时间。

**4. 传播延迟**是指数据包的第一个比特位从发送端到达接收端的时间。通常也被称为距离的延迟，受数据传输距离和传播速度的影响。

## 延迟的影响
延迟的影响主要体现在实时通信的用户体验上。在音视频通话中，当延迟达到150毫秒时，用户体验就将受到影响；当延迟达到400毫秒时，用户能明显感知到延迟存在。不仅如此，延迟还可能造成音视频不同步等问题。

### 更近一步
基于音视频的实时通信中，通常会连续传输数据包以保持信息实时传播。由于IP网络路由状态频繁变化使得每个数据包分别经由不同的物理路由到达或者节点流量拥塞，数据包在各节点缓存时间过长，使得数据包到达接收端的时间差较大。这种延迟差异被称为**抖动**。抖动对实时音视频通信来说是相当大的问题。
